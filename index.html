<!DOCTYPE html>
<html>
<head>
  <title>NFL Predictions</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    td, th { padding: 8px; border: 1px solid #ddd; text-align: center; }
    input { width: 50px; padding: 4px; text-align: center; }
    button { padding: 10px 20px; background: #007BFF; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>

<h2>NFL Predictions</h2>
<form id="predictionForm">
  <table id="fixturesTable">
    <tr><th>Fixture</th><th>Home Score</th><th>Away Score</th></tr>
  </table>
  <label>Your Name: <input type="text" name="name" required></label>
  <br><br>
  <button type="submit">Submit Predictions</button>
</form>

<p id="message"></p>

<script>
const FIXTURES_SHEET_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR_SOt6BpGnlvgnsnbaxeneop-gD7rcSwLWUp9P7O2zP-H8j5Q-lIDKvjvudN4XU08w67i9NhowNsBT/pub?gid=0&single=true&output=csv"; // Publish-to-Web CSV
const SUBMIT_URL = "https://script.google.com/macros/s/AKfycbwGNPzPvTHqrfMr926y6SJnWQh3x-sy9wblXcru3fqukUke3mzaOaf9PETFL0j4O9SMiw/exec"; // Web App URL from Apps Script

// Load fixtures dynamically
fetch(FIXTURES_SHEET_CSV)
  .then(response => response.text())
  .then(text => {
    const rows = text.trim().split("\n").slice(1); // skip header row
    const table = document.getElementById("fixturesTable");

    rows.forEach((row, index) => {
      const [home, away, gameId] = row.split(",");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${home} vs ${away}</td>
        <td><input type="number" name="game${index+1}_home" required></td>
        <td><input type="number" name="game${index+1}_away" required></td>
      `;
      table.appendChild(tr);
    });
  })
  .catch(err => console.error("Error loading fixtures:", err));

// Handle form submission
document.getElementById("predictionForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const formData = new FormData(this);
  const data = {};
  formData.forEach((value, key) => data[key] = value);

  fetch(SUBMIT_URL, {
    method: "POST",
    body: JSON.stringify(data),
    headers: { "Content-Type": "application/json" }
  })
  .then(response => response.json())
  .then(result => {
    if(result.status === "success"){
      document.getElementById("message").textContent = "Predictions submitted successfully!";
      this.reset();
    } else {
      document.getElementById("message").textContent = "Error: " + result.message;
    }
  })
  .catch(err => {
    document.getElementById("message").textContent = "Submission failed. Check console for errors.";
    console.error(err);
  });
});
</script>

</body>
</html>
